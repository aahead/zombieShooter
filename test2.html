<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Top-Down Zombie Shooter - Health Bar & Game Over</title>
  <style>
    body { margin: 0; overflow: hidden; }
    canvas { background: #444; display: block; }
    #game-over {
      position: absolute;
      top: 0;
      left: 0;
      width: 100vw;
      height: 100vh;
      background: rgba(0, 0, 0, 0.8);
      color: white;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      font-family: Arial, sans-serif;
      font-size: 48px;
      display: none;
    }
    #restart-btn {
      margin-top: 20px;
      padding: 10px 20px;
      font-size: 24px;
      cursor: pointer;
      border: none;
      border-radius: 10px;
      background: #00aaff;
      color: white;
    }
    #restart-btn:hover {
      background: #0088cc;
    }
  </style>
</head>
<body>
<canvas id="game"></canvas>

<div id="game-over">
  <div>YOU DIED</div>
  <button id="restart-btn">Play Again</button>
</div>
<div id="damage-overlay"></div>
<style>
  #damage-overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100vw;
      height: 100vh;
      background: rgba(255, 0, 0, 0.4);
      pointer-events: none;
      opacity: 0;
      transition: opacity 0.4s ease-out;
      z-index: 9999;
    }
</style>


<div id="wave-countdown">
  <div id="wave-text">Wave 1 in 10s</div>
</div>

<style>
  #wave-countdown {
    position: absolute;
    top: 0; left: 0;
    width: 100vw; height: 100vh;
    background: rgba(0, 0, 0, 0.75);
    display: none;              /* hidden by default */
    align-items: center;
    justify-content: center;
    flex-direction: column;
    color: white;
    font-family: Arial, sans-serif;
    font-size: 48px;
    z-index: 10000;
  }
</style>


<script>


const waveCountdown = document.getElementById('wave-countdown');
const waveText      = document.getElementById('wave-text');



let zombiesToSpawn = 20;
let zombiesSpawned = 0;
let inRestPeriod = false;
let restTimer = 0;


// Grenade properties
let grenades = [];
// Nuke properties
let nukes = [];

// Add key event listener for throwing the grenade
//window.addEventListener('keydown', e => {
  //if (e.key === 'g' && !isReloading && ammo > 0 && !isDead) {
    //throwGrenade();
  //}
//});

function throwGrenade() {
  if (grenadeAmmo > 0) {
    const grenadeSpeed = 300;
    const angle = Math.atan2(mouse.y - canvas.height / 2, mouse.x - canvas.width / 2);
    const velocity = {
      x: Math.cos(angle) * grenadeSpeed,
      y: Math.sin(angle) * grenadeSpeed,
    };

    const grenade = {
      x: player.x,
      y: player.y,
      velocity,
      radius: 5,
      fuse: 1.5, // seconds until explosion
      exploded: false,
      explosionTimer: 0,
    };

    grenades.push(grenade);
    grenadeAmmo--;
  }
}


function moveGrenades(deltaTime) {
  for (let i = grenades.length - 1; i >= 0; i--) {
    let grenade = grenades[i];

    if (!grenade.exploded) {
      grenade.x += grenade.velocity.x * deltaTime;
      grenade.y += grenade.velocity.y * deltaTime;
      grenade.fuse -= deltaTime;

      if (grenade.fuse <= 0) {
        explodeGrenade(grenade);
        grenade.exploded = true;
        grenade.explosionTimer = 0.5;
      }
    } else {
      grenade.explosionTimer -= deltaTime;
      if (grenade.explosionTimer <= 0) {
        grenades.splice(i, 1);
      }
    }
  }
}



function explodeGrenade(grenade) {
  grenade.exploded = true;
  const EXPLOSION_RADIUS = 100;
  // Collect zombies to remove after loop
  const zombiesToRemove = [];

  for (const zombie of zombies) {
    const dx = zombie.x - grenade.x;
    const dy = zombie.y - grenade.y;
    const distance = Math.sqrt(dx * dx + dy * dy);

    if (distance < EXPLOSION_RADIUS) {
      zombiesToRemove.push(zombie);
    }
  }

  // Remove zombies safely
  for (const zombie of zombiesToRemove) {
    const index = zombies.indexOf(zombie);
    if (index !== -1) zombies.splice(index, 1);
  }
}

function drawGrenades(ctx) {
  grenades.forEach(grenade => {
    ctx.beginPath();
    ctx.arc(
      grenade.x - camera.x,
      grenade.y - camera.y,
      grenade.radius,
      0,
      Math.PI * 2
    );
    ctx.fillStyle = 'darkgreen';
    ctx.fill();
    ctx.closePath();
  });
}



function drawMiniMap() {
  const miniMapWidth = 200;
  const miniMapHeight = 133; // Keep aspect ratio (3000x2000 map)
  const margin = 20;
  const scaleX = miniMapWidth / map.width;
  const scaleY = miniMapHeight / map.height;

  const miniMapX = canvas.width - miniMapWidth - margin;
  const miniMapY = canvas.height - miniMapHeight - margin;

  // Mini-map background
  ctx.fillStyle = 'rgba(0, 0, 0, 0.6)';
  ctx.fillRect(miniMapX, miniMapY, miniMapWidth, miniMapHeight);
  ctx.strokeStyle = 'white';
  ctx.strokeRect(miniMapX, miniMapY, miniMapWidth, miniMapHeight);

  // Draw player on mini-map
  ctx.fillStyle = 'white';
  ctx.beginPath();
  ctx.arc(
    miniMapX + player.x * scaleX,
    miniMapY + player.y * scaleY,
    4,
    0,
    Math.PI * 2
  );
  ctx.fill();

  // Draw zombies on mini-map
  ctx.fillStyle = 'red';
  for (let zombie of zombies) {
    ctx.beginPath();
    ctx.arc(
      miniMapX + zombie.x * scaleX,
      miniMapY + zombie.y * scaleY,
      2,
      0,
      Math.PI * 2
    );
    ctx.fill();
  }
}



const muzzleFlashImage = new Image();
muzzleFlashImage.src = 'muzzleflash.png'; // (Change this to your actual file name)



// Setup
const canvas = document.getElementById('game');
const ctx = canvas.getContext('2d');
canvas.width = window.innerWidth;
canvas.height = window.innerHeight;
const gameOverScreen = document.getElementById('game-over');
const restartBtn = document.getElementById('restart-btn');

// Images
const zombieImage = new Image(); zombieImage.src = 'zombie.png';
const characterImage = new Image(); characterImage.src = 'download.png';
const reloading1 = new Image(); reloading1.src = 'reloading.png';
const reloading2 = new Image(); reloading2.src = 'reloading2.png';
const reloading3 = new Image(); reloading3.src = 'reloading3.png';
const shotgunImage = new Image(); shotgunImage.src = 'pixelShotgun.png';
const bulletImage = new Image(); bulletImage.src = 'bullet.png';
const shotgunShell = new Image(); shotgunShell.src = 'shell.png';
const medkitImage = new Image(); medkitImage.src = 'medkit.png';
const medkitZombieImage = new Image(); medkitZombieImage.src = 'medzombie.png';
const mapImage = new Image(); mapImage.src = 'map.png';
const nukeImg = new Image(); nukeImg.src = 'nuke.png';

const reloadFrames = [characterImage, reloading1, reloading2, reloading3, reloading2, characterImage];
const RELOAD_DURATION = 3;
const map = { width:3000, height:2000 };
let player = { x:map.width/2, y:map.height/2, size:40, speed:4, direction:'down', weapon:null };
let keys={}, bullets=[], zombies=[], medkits=[], shotguns=[];
let totalZombiesSpawned=0, spawnRate=1000, lastSpawnTime=0;
let wave=1, lastFrameTime=performance.now();
let health=100, ammo=20, isReloading=false, reloadTimer=0, isDead=false;
let hasShotgun=false, shotgunShotsLeft=0, shotgunSpawnTimer=0;
const SHOTGUN_SPAWN_INTERVAL=20;

function spawnShotgun(){ if(shotguns.length<2) shotguns.push({x:Math.random()*map.width,y:Math.random()*map.height,size:20}); }
function spawnNuke(){ nukes = [{x:Math.random()*map.width,y:Math.random()*map.height,size:32}]; }

window.addEventListener('keydown', e=>{ keys[e.key]=true; if(e.key==='r'&&ammo>0&&!isReloading&&!isDead){ isReloading=true; reloadTimer=0; ammo=0; } });
window.addEventListener('keyup', e=>keys[e.key]=false);
window.addEventListener('click', shoot);
restartBtn.addEventListener('click', resetGame);

function shoot(e){
  if(player.weapon==='nuke'){ zombies.length=0; player.weapon=null; return; }
  if(isReloading||ammo<=0||isDead) return;
  // ... existing shoot code ...
}

function movePlayer(){
  // ... existing movement and pickups ...
  // Nuke pickup
  for(let i=nukes.length-1;i>=0;i--){
    const n=nukes[i];
    if(Math.hypot(player.x-n.x,player.y-n.y)<player.size+n.size){
      player.weapon='nuke'; nukes.splice(i,1);
    }
  }
}


function drawMap(){ ctx.drawImage(mapImage,0,0,map.width,map.height); shotguns.forEach(s=>ctx.drawImage(shotgunImage,s.x-40,s.y-40,80,80)); }
function drawNukes(){ nukes.forEach(n=>ctx.drawImage(nukeImg,n.x-n.size/2,n.y-n.size/2,n.size,n.size)); }

let camX=0, camY=0;
function gameLoop(now){
  if(isDead)return;
  const dt=(now-lastFrameTime)/1000; lastFrameTime=now;
  movePlayer(); moveBullets(); moveZombies(dt); moveGrenades(dt); checkCollisions();
  // spawn logic...
  if(!inRestPeriod&&zombiesSpawned<zombiesToSpawn&&performance.now()-lastSpawnTime>spawnRate){ spawnZombie(); zombiesSpawned++; lastSpawnTime=performance.now(); }
  if(!inRestPeriod&&zombiesSpawned===zombiesToSpawn&&zombies.length===0){ inRestPeriod=true; restTimer=0; }
  if(inRestPeriod){ restTimer+=dt; const secs=Math.max(0,Math.ceil(10-restTimer)); waveCountdown.style.display='flex'; waveText.textContent=`Wave ${wave+1} in ${secs} seconds`;
    if(restTimer>=10){ waveCountdown.style.display='none'; wave++; zombiesToSpawn=20+(wave-1)*10; zombiesSpawned=0; inRestPeriod=false; restTimer=0; ammo=20; isReloading=false; reloadTimer=0; if(wave===1)spawnNuke(); }
  } else waveCountdown.style.display='none';
  camX=Math.max(0,Math.min(map.width-canvas.width,player.x-canvas.width/2));
  camY=Math.max(0,Math.min(map.height-canvas.height,player.y-canvas.height/2));
  ctx.setTransform(1,0,0,1,-camX,-camY); ctx.clearRect(camX,camY,canvas.width,canvas.height);
  drawMap(); drawNukes(); drawPlayer(); drawBullets(); drawZombies(); drawMedkits(); drawGrenades(); updateMuzzleFlash(dt); drawMuzzleFlash(); drawUI();
  if(isReloading){ reloadTimer+=dt; if(reloadTimer>=RELOAD_DURATION){ isReloading=false; ammo=20; } }
  shotgunSpawnTimer+=dt; if(shotgunSpawnTimer>=SHOTGUN_SPAWN_INTERVAL){ spawnShotgun(); shotgunSpawnTimer=0; }
  requestAnimationFrame(gameLoop);
}

function resetGame(){
  health=100; ammo=20; isReloading=false; reloadTimer=0; isDead=false;
  zombies=[]; bullets=[]; grenades=[]; medkits=[]; shotguns=[]; nukes=[];
  totalZombiesSpawned=0; zombiesToSpawn=20; zombiesSpawned=0;
  inRestPeriod=false; restTimer=0; wave=1; spawnRate=1000; lastSpawnTime=0;
  shotgunSpawnTimer=0; hasShotgun=false; shotgunShotsLeft=0;
  player={x:map.width/2,y:map.height/2,size:40,speed:4,direction:'down',weapon:null};
  gameOverScreen.style.display='none'; spawnShotgun(); spawnShotgun(); spawnNuke(); lastFrameTime=performance.now();
  requestAnimationFrame(gameLoop);
}

resetGame();
</script>
</body>
</html>
